# Example workflow for using repo-file-sync action
name: Example File Sync

on:
  push:
  workflow_dispatch:

jobs:
  sync-files:
    runs-on: ubuntu-latest
    name: Sync repository files

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Sync files from configured repositories
        uses: ./
        with:
          config: '.github/repo-file-sync.yaml'
          github-token: ${{ secrets.GITHUB_TOKEN }}
          dry-run: 'true'
        id: file-sync

      - name: Display sync results
        run: |
          echo "ðŸ“Š Sync Results:"
          echo "âœ… Files synced: ${{ steps.file-sync.outputs.files-synced }}"
          echo "âŒ Files failed: ${{ steps.file-sync.outputs.files-failed }}"
          echo "ðŸ“¦ Total bytes downloaded: ${{ steps.file-sync.outputs.total-bytes }}"

      - name: Check for changes
        id: verify-changed-files
        run: |
          if [ -n "$(git status --porcelain)" ]; then
            echo "changed=true" >> "${GITHUB_OUTPUT}"
            echo "ðŸ“ Changes detected in synced files"
          else
            echo "changed=false" >> "${GITHUB_OUTPUT}"
            echo "âœ¨ No changes in synced files"
          fi

      - name: Create summary
        run: |
          echo "## ðŸ“‹ File Sync Summary" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "| Metric | Value |" >> $GITHUB_STEP_SUMMARY
          echo "|--------|-------|" >> $GITHUB_STEP_SUMMARY
          echo "| Files synced | ${{ steps.file-sync.outputs.files-synced }} |" >> $GITHUB_STEP_SUMMARY
          echo "| Files failed | ${{ steps.file-sync.outputs.files-failed }} |" >> $GITHUB_STEP_SUMMARY
          echo "| Total bytes | ${{ steps.file-sync.outputs.total-bytes }} |" >> $GITHUB_STEP_SUMMARY
          echo "| Changes committed | ${{ steps.verify-changed-files.outputs.changed }} |" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          if [ "${{ steps.file-sync.outputs.files-failed }}" -gt 0 ]; then
            echo "âš ï¸ Some files failed to sync. Check the logs for details." >> $GITHUB_STEP_SUMMARY
          else
            echo "âœ… All files synced successfully!" >> $GITHUB_STEP_SUMMARY
          fi